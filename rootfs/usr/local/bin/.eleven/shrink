#!/bin/sh
  # eleven shrink /path/to/binary/to/be/stripped

  if [ -f "${1}" ]; then
    /usr/local/bin/upx -q --no-backup -9 --best --lzma $@ > /tmp/upx 2> /tmp/upx
    if cat /tmp/upx | grep -q "Packed 1 file."; then
      LINE=$(cat /tmp/upx | grep " -> " | sed 's/->/ /' | sed 's/  //')
      BYTES_BEFORE=$(echo "${LINE}" | awk -F ' ' '{print $1}')
      BYTES_AFTER=$(echo "${LINE}" | awk -F ' ' '{print $2}')
      BYTES_PERCENT=$(echo "${LINE}" | awk -F ' ' '{print $3}')
      FILE=$(echo "${LINE}" | awk -F ' ' '{print $5}')
      if [ ${#FILE} -gt 0 ]; then
        BYTES_SHRUNK=$(((${BYTES_BEFORE} - ${BYTES_AFTER})/1024))
        eleven log info "${FILE} shrunk by ${BYTES_PERCENT} (~${BYTES_SHRUNK}kB)"
      fi
      rm -rf /tmp/upx
    fi
  else
    eleven log warning "could not find file [${1}]"
    exit 1
  fi

  exit 0