#!/bin/sh
  FN=$(echo "${1}" | tr '[:upper:]' '[:lower:]')
  shift

  case "${FN}" in
    "asset")
      GITHUB_ASSET_SHA256=$(/usr/local/bin/curl -s -H "Accept: application/vnd.github+json" -H "X-GitHub-Api-Version: 2022-11-28" https://api.github.com/repos/${1}/releases | jq --raw-output '.[] | select(.tag_name == "'${2}'") | .assets[] | select(.name == "'${3}'") | .digest' | sed 's/sha256://')
      GITHUB_ASSET_URL=$(/usr/local/bin/curl -s -H "Accept: application/vnd.github+json" -H "X-GitHub-Api-Version: 2022-11-28" https://api.github.com/repos/${1}/releases | jq --raw-output '.[] | select(.tag_name == "'${2}'") | .assets[] | select(.name == "'${3}'") | .browser_download_url')
      if [ -z "${GITHUB_ASSET_URL}" ]; then
        eleven log warning "could not get a release for ${1}"
        GITHUB_ASSET_URL=https://github.com/${1}/archive/refs/tags/${3}
      fi

      GITHUB_ASSET=$(echo ${GITHUB_ASSET_URL} | awk -F '/' '{print $NF}')
      /usr/local/bin/curl -sSL ${GITHUB_ASSET_URL} -o ${GITHUB_ASSET}

      if [ "${GITHUB_ASSET_SHA256}" != "null" ]; then
        echo "${GITHUB_ASSET_SHA256} ${GITHUB_ASSET}" | sha256sum -c &> /dev/null
      else
        eleven log warning "could not get sha256 checksum for ${1}"
      fi
      /usr/local/bin/pv ${GITHUB_ASSET} | tar xz;
    ;;

    *) 
      eleven log warning "function ${FN} does not exist"
      exit 1
    ;;
  esac